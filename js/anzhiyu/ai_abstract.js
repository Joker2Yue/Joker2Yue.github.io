!function(){const{randomNum:n,basicWordCount:i,btnLink:e,key:o,Referer:l,gptName:t,switchBtn:a,mode:r}=GLOBAL_CONFIG.postHeadAiDescription,{title:s,postAI:c,pageFillDescription:d}=GLOBAL_CONFIG_SITE;let m=-1,y=!0,u=r,h=0,f,p=null,g=!1,T=null;const v=document.querySelector(".post-ai-description"),b=v.querySelector(".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right");let E=v.querySelector(".anzhiyu-icon-circle-dot");const L=v.querySelector(".ai-explanation");let k="",M="",I,A=0,S=0,q=[],w=0;const G=new IntersectionObserver(e=>{e=e[0].isIntersecting;(y=e)&&(I=0===A?200:20,q[1]=setTimeout(()=>{S&&(A=0,S=0),0===A&&(L.innerHTML=k.charAt(0)),requestAnimationFrame(x)},I))},{threshold:0}),B=[function(){"tianli"==u?j("我是文章辅助AI: TianliGPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。"):j(`我是文章辅助AI: ${t} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`)},function(){b.click()},function(){A=0,S=1,P(),y=!1,w=0,L.innerHTML="生成中. . .",k="",M="",G.disconnect(),q[2]=setTimeout(()=>{L.innerHTML=function(){let n=document.querySelectorAll(".relatedPosts-list a");if(!n.length){var e=document.querySelector(".card-widget.card-recent-post");if(!e)return"";n=e.querySelectorAll(".aside-list-item a");let t="";for(let e=0;e<n.length;e++){var i=n[e];t+=`<div class="ai-recommend-item"><span class="index">${e+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${i.href}')" title="${i.title}" data-pjax-state="">${i.title}</a></div>`}return`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${t}</div>`}let t="";for(let e=0;e<n.length;e++){var a=n[e];t+=`<div class="ai-recommend-item"><span>推荐${e+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${a.href}')" title="${a.title}" data-pjax-state="">${a.title}</a></div>`}return`推荐文章：<br /><div class="ai-recommend">${t}</div>`}()},600)},function(){j("正在前往博客主页...",!1),q[2]=setTimeout(()=>{window.pjax?pjax.loadUrl("/"):location.href=location.origin},1e3)}];var $=v.querySelectorAll(".ai-btn-item");function x(e){var t;y&&(x.start||(x.start=e),20<=(w=e-x.start)?(x.start=e,A<M-1&&(e=k.charAt(A+1),t=/[,.，。!?！？]/.test(e)?150:20,L.firstElementChild&&L.removeChild(L.firstElementChild),L.innerHTML+=e,(e=document.createElement("div")).className="ai-cursor",L.appendChild(e),A++,150==t&&(v.querySelector(".ai-explanation .ai-cursor").style.opacity="0.2"),A===M-1&&(G.disconnect(),L.removeChild(L.firstElementChild)),q[0]=setTimeout(()=>{requestAnimationFrame(x)},t))):requestAnimationFrame(x))}function P(){q.length&&q.forEach(e=>{e&&clearTimeout(e)})}function j(e,t=!0){A=0,S=1,P(),y=!1,w=0,G.disconnect(),L.innerHTML=t?"生成中. . .":"请等待. . .",k=e,M=k.length,G.observe(v)}async function H(e=i){if("tianli"===u)(async function(e){A=0,S=1,P(),y=!1,w=0,G.disconnect(),e=Math.max(10,Math.min(2e3,e));var t={key:o,Referer:l},e=(s+d).trim().substring(0,e),n={key:t.key,content:e,url:location.href},t={method:"POST",headers:{"Content-Type":"application/json",Referer:t.Referer},body:JSON.stringify(n)};console.info(e.length);try{i=setInterval(()=>{var e="生成中"+".".repeat(S);L.innerHTML=e,S=S%3+1},500);var i,a,r=await fetch("https://summary.tianli0.top/",t);let e;e=403===r.status?{summary:"403 refer与key不匹配。"}:500===r.status?{summary:"500 系统内部错误"}:await r.json(),a=e.summary.trim(),T=e.id,setTimeout(()=>{b.style.opacity="1"},300),j(a||"摘要获取失败!!!请检查Tianli服务是否正常!!!"),clearInterval(i)}catch(e){console.error(e),L.innerHTML="发生异常"+e}})(e);else{var t=c.split(",").map(e=>e.trim());if(1!==t.length){let e=Math.floor(Math.random()*t.length);for(;e===m;)e=Math.floor(Math.random()*t.length);m=e,j(t[e])}else j(t[0]);setTimeout(()=>{b.style.opacity="1"},600)}}Array.from($).filter(e=>"go-tianli-blog"!==e.id).forEach((e,t)=>{e.addEventListener("click",()=>{B[t]()})}),document.getElementById("ai-tag").addEventListener("click",function(){"tianli"===u?(v.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="none"),document.getElementById("go-tianli-blog").style.display="block",j("你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。")):(v.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="block"),document.getElementById("go-tianli-blog").style.display="none",j(`你好，我是本站摘要生成助理${t} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`))}),b.addEventListener("click",function(){var t=(s+d).trim().substring(0,i);if(b.style.opacity="0.2",b.style.transitionDuration="0.3s",b.style.transform="rotate("+360*h+"deg)",t.length<=i){let e=t.length-Math.floor(Math.random()*n);for(;e===f||t.length-e===f;)e=t.length-Math.floor(Math.random()*n);H(f=e)}else{let e=Math.floor(Math.random()*n)+i;for(;e===f||t.length-e===f;)e=Math.floor(Math.random()*n)+i;H(e)}h++}),document.getElementById("go-tianli-blog").addEventListener("click",()=>{window.open(e,"_blank")}),E.addEventListener("click",async function(){if(T)if((E=v.querySelector(".anzhiyu-icon-circle-dot")).style.opacity="0.2",p&&!g)p.pause(),g=!0,E.style.opacity="1",E.style.animation="",E.style.cssText="animation: ''; opacity: 1;cursor: pointer;";else if(p&&g)p.play(),g=!1,E.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer";else{var e={key:o,Referer:l},t=new URLSearchParams({key:e.key,id:T}),e={method:"GET",headers:{"Content-Type":"application/json",Referer:e.Referer}};try{var n,i,a=await fetch("https://summary.tianli0.top/audio?"+t,e);403===a.status?console.error("403 refer与key不匹配。"):500===a.status?console.error("500 系统内部错误"):(n=await a.blob(),i=URL.createObjectURL(n),(p=new Audio(i)).play(),E.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer",p.addEventListener("ended",()=>{p=null,E.style.opacity="1",E.style.animation=""}))}catch(e){console.error("请求发生错误❎")}}else anzhiyu.snackbarShow("摘要还没加载完呢，请稍后。。。")}),a&&document.getElementById("ai-Toggle").addEventListener("click",function(){"tianli"==(u="tianli"===u?"local":"tianli")?(document.getElementById("ai-tag").innerHTML="TianliGPT",E.style.opacity="1",E.style.cursor="pointer"):(E.style.opacity="0",E.style.cursor="auto",document.getElementById("go-tianli-blog").style.display="block",document.querySelectorAll(".ai-btn-item").forEach(e=>e.style.display="block"),document.getElementById("go-tianli-blog").style.display="none",document.getElementById("ai-tag").innerHTML=t+" GPT");H()}),H(),"tianli"===u?document.getElementById("ai-tag").innerHTML="TianliGPT":document.getElementById("ai-tag").innerHTML=t+" GPT"}();